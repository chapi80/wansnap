<!DOCTYPE html>
<html lang='ja'>

{% extends "app/base.html" %}

{% block title %}うちの子の部屋画面 - ワンスナップ{% endblock %}

{% block content %}
    <h2>{{ dog.dog_name }}の部屋</h2>
    
        {% if dog.dog_image and dog.dog_image.name %}
            <div class="dog-photo-detail-container">
                <img src="{{ dog.dog_image.url }}" alt="{{ dog.dog_name }}" class="dog-photo-detail-container">
            </div>
        {% else %}
            <p>画像は登録されていません</p>
        {% endif %}

        <p>うちの子の名前:{{ dog.dog_name }}</p><br><br>

        <p>犬種:{{ dog.breed }}</p><br><br>

        <p>性別:{{ dog.gender }}</p><br><br>

        <p>うちの子の誕生日:{{ dog.birthday }}</p><br><br>

        <p>うちの子からひとこと:{{ dog.biography }}</p><br><br>

        <a href="{% url 'edit_dog' dog.id %}">
            <button type = "button">登録情報修正</button>
        </a><br><br>

        <h1>🐶今までの思い出🐶</h1>

        <form method="get">

            <label>
                <input type="radio" name="sort" value="new" {% if request.GET.sort == 'new' or not request.GET.sort %}checked{% endif %}>
                新しい順
            </label>
        
            <label>
                <input type="radio" name="sort" value="old" {% if request.GET.sort == 'old' %}checked{% endif %}>
                古い順
            </label>

            <input type="text" name='q' placeholder="2025-5 などで検索" value="{{ request.GET.q }}">
            <button type="submit">🔍</button>

        </form>

        <div class="image-grid">
            {% for post in posts %}
                <div class="image-card">
                    <img
                        src="{{ post.image.url }}"
                        alt="投稿画像"
                        class="post-image"
                        onclick="openModal(this)"
                        data-image="{{ post.dog_image.url }}"
                        data-name="{{ dog.dog_name }}"
                        data-breed="{{ dog.breed }}"
                        data-gender="{{ dog.gender }}"
                        data-image="{{ post.caption }}"
                        {% if post.is_own %}
                            data-memo="{{ post.memo }}"
                        {% else %}
                            data-memo=""
                        {% endif %}
                    >
                </div>
            {% empty %}
                <p>まだ投稿がありません</p>
            {% endfor%}
        </div>
        
        <div id ="postModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <img id="modal-image" src="" alt="投稿画像" style="width: 100%;"><br><br>

                <p><strong>うちの子の名前：</strong><span id="modal-name"></span></p>
                <p><strong>犬種：</strong><span id="modal-breed"></span></p>
                <p><strong>性別：</strong><span id="modal-gender"></span></p>
                <p><strong>うちの子からひとこと：</strong><span id="modal-caption"></span></p>
                <p id="memo-line" style="display: none;"><strong>メモ：</strong><span id="modal-memo"></span></p>
                <button id="favorite-button" data-post-id="">★</button>
            </div>
        </div>

    <script>
        function openModal(imgElement){
            const image = imgElement.getAttribute('data-image');
            const name = imgElement.getAttribute('data-name');
            const breed = imgElement.getAttribute('data-breed');
            const gender = imgElement.getAttribute('data-gender');
            const caption = imgElement.getAttribute('data-caption');
            const memo = imgElement.getAttribute('data-memo');

            document.getElementById('modal-image').src = image;
            document.getElementById('modal-name').textContent = name;
            document.getElementById('modal-breed').textContent = breed;
            document.getElementById('modal-gender').textContent = gender;
            document.getElementById('modal-caption').textContent = caption;
            document.getElementById('modal-memo').textContent = memo;
            
            const memoLine = document.getElementById('memo-line');
            if (memo) {
                memoLine.style.display = "block";
            } else {
                memoLine.style.display = "none";
            }
            
            document.getElementById('postModal').style.display = "block";
        }

        document.addEventListener('DOMContentLoaded', function (){
            const modal = document.getElementById('postModal');
            const closeBtn = modal.querySelector('.close');

            closeBtn.onclick = function () {
                modal.style.display = "none";
            }

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        });
    </script>

{% endblock %}