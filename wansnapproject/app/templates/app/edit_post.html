<!DOCTYPE html>
<html lang='ja'>

{% extends "app/base.html" %}
{% load static %}

{% block title %}ã†ã¡ã®å­æŠ•ç¨¿ç·¨é›†ãƒšãƒ¼ã‚¸ç”»é¢ - ãƒ¯ãƒ³ã‚¹ãƒŠãƒƒãƒ—{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/base.css' %}">
<link rel="stylesheet" href="{% static 'app/delete.css' %}">
{% endblock %}

{% block content %}
<div class="form-wrapper">
    <h2>ğŸ¾ã†ã¡ã®å­æŠ•ç¨¿ç·¨é›†ãƒšãƒ¼ã‚¸</h2>
            
            <form method="POST" enctype="multipart/form-data" class="post-form">
                {% csrf_token %}
                
                {{ edit_post_form.dog.label_tag }}<br>
                {{ edit_post_form.dog }}<br><br>
                {% for error in edit_post_form.dog.errors %}
                    <span style="color:red">{{ error }}</span><br>
                {% endfor %}

                å†™çœŸï¼š<br>
                <div class="file-wrapper">
                    <label for="{{ edit_post_form.image.id_for_label }}" class="file-label">ç”»åƒã‚’é¸æŠ</label>
                    {{ edit_post_form.image }}
                </div>

                {% if post.image %}
                    <div class="image-info">
                        ç¾åœ¨:
                        <a href="{{ post.image.url }}" target="_blank">{{ post.image.name }}</a>
                    </div>
                    
                    <div class="change-note" id="no-change-note">
                        å¤‰æ›´ï¼šé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“
                    </div>

                    <div class="change-note" id="change-note" style="display: none;">
                        å¤‰æ›´ï¼š
                        <a href="#" id="change-link" target="_blank">
                            <span id="change-filename"></span>
                        </a>
                    </div><br>
                {% endif %}                

                {% for error in edit_post_form.image.errors %}
                    <span style="color:red">{{ error }}</span><br>
                {% endfor %}
        
                {{ edit_post_form.caption.label_tag }}<br>
                {{ edit_post_form.caption }}<br><br>

                {{ edit_post_form.memo.label_tag }}<br>
                {{ edit_post_form.memo }}<br><br>

                <div class="button-wrapper">
                    <button type="submit" class="submit-button">ç™»éŒ²ã™ã‚‹</button>
                </div>

            </form><br>

            <div class="button-wrapper">
                <button type="button" class="delete-button" onclick="openDeleteModal()">æŠ•ç¨¿ã‚’å‰Šé™¤ã™ã‚‹</button>
            </div>

            <a href="{% url 'mypage' %}" class="cancel-link">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>

        <div id="deleteModal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn" onclick="closeDeleteModal()">&times;</span>
                <p>æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
                <form method="POST" action="{% url 'delete_post' post_id %}">
                    {% csrf_token%}
                    <button type="submit">å‰Šé™¤ã™ã‚‹</button>
                    <button type="button" onclick="closeDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </form>
            </div>
        </div>

        <script>
        function openDeleteModal() {
            document.getElementById("deleteModal").style.display = "flex";
        }
        function closeDeleteModal() {
            document.getElementById("deleteModal").style.display = "none";
        }

        document.addEventListener('DOMContentLoaded', function() {
            const deleteModal = document.getElementById("deleteModal");
            deleteModal.addEventListener('click', function (event) {
                if (event.target === deleteModal) {
                    closeDeleteModal();
                }
            });

            deleteModal.style.display = "none";

            const fileInput = document.getElementById('{{ edit_post_form.image.id_for_label }}');
            const changeFilename = document.getElementById('change-filename');
            const changeLink = document.getElementById('change-link');
            const changeNote = document.getElementById('change-note');
            const noChangeNote = document.getElementById('no-change-note');

            fileInput.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    const tempUrl = URL.createObjectURL(file);
                    changeFilename.textContent = file.name;
                    changeLink.href = tempUrl;
                    changeNote.style.display = 'block';
                    noChangeNote.style.display = 'none';
                } else {
                    changeFilename.textContent = 'é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“';
                    changeLink.href = '#';
                    changeNote.style.display = 'none';
                    noChangeNote.style.display = 'block';
                }
            });
        });

        </script>
        
{% endblock %}